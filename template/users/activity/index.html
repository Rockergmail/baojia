<!DOCTYPE html>
<html>
<head lang="zh-cmn-Hans">
    <meta text-tipset="UTF-8">
    <title>新手活动</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0">
    <!-- 360用GCF渲染 -->
    <meta name="renderer" content="webkit">
    <!-- 优先使用最新IE内核,chrome内核 -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <!-- 禁止百度转码 -->
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <link rel="stylesheet" href="http://w.qiandeer.com/qd/static/lock/assets/global.css">
    <style>body{color:white;}.tip-layer{background:rgba(0,0,0,.8);width:100%;height:100%;overflow:hidden;-webkit-transform:translateZ(0);transform:translateZ(0)}.absolute{position:absolute}#section-welcome{width:320px;height:350px;left:50%;top:50%;margin-left:-160px;margin-top:-175px;-webkit-transform:translateZ(0);transform:translateZ(0)}#section-moneyget{left:50%;margin-left:-140px;top:50%;margin-top:-210px;display:none;-webkit-transform:translateZ(0)}#btn-welcome-close,#btn-moneyget-close{right:0;top:0;padding: 25px;z-index: 9999}#btn-getmoney{bottom:-13px;left:50%;margin-left:-35px;}#btn-getmoney:before{content:attr(data-content);color:white;text-align: center;display: block;}#text-timeoutTips{width:280px;margin-top:30px;}#text-money{margin-top:20px;text-align:center;color:#fff}@-webkit-keyframes animations{0%{-webkit-transform:scale(.3);opacity:0}20%{-webkit-transform:scale(.6);opacity:1}80%{-webkit-transform:scale(1.2)}100%{-webkit-transform:scale(1)}}@keyframes animations{0%{transform:scale(0);opacity:0}20%{transform:scale(.6);opacity:1}80%{transform:scale(1.2)}100%{transform:scale(1)}}.zoom{-webkit-animation:animations .5s ease-out;animation:animations .5s ease-out}</style></head><body>
<div class="tip-layer absolute">
    <!-- 第一页 -->
    <section id="section-welcome" class="absolute">
        <img id="btn-welcome-close" class="absolute" src="/static/images/jingling/mode/close.png" width="30px" title="关闭 ">
        <div id="div_section-welcome" class="absolute">
            <div id='btn-getmoney' class="absolute"><img src="/static/images/jingling/mode/modeget.png"  width="70px" title="抢"></div>
            <img src="/static/images/jingling/mode/modebg.png" width="320px" title="bg">
        </div>
    </section>

    <!-- 第二页 -->
    <section id="section-moneyget" class="absolute">
        <header>
            <img src="/static/images/jingling/mode/close.png" id="btn-moneyget-close" class="absolute" width="30px" title="关闭 ">
            <img src="/static/images/jingling/mode/mode2.png" width="280px" title="bg" style="vertical-align:top;">
        </header>
        <section style="background-color:#d73727;overflow:hidden;height:276px;-webkit-border-radius:0px 0px 6px 6px;">
            <div id="text-timeoutTips">
                <p class="fc-white tac fs-14">每天都可以在<span style="color:#ff0;font-size:16px;vertical-align:middle;font-weight:bold;"> “ 每日红包 ” </span>领取红包哟!</p>
                <p id="text-money"><span id="text-bonus" style="font-size:70px">0.00</span>元</p>
                <p class="tac fs-14" style="color:rgba(255,255,255,.5);margin-top:-10px;">已存入你的余额</p>
                <div class="fs-16 tac" style="margin-top:30px;"><span style="border:1px solid #fff;-webkit-border-radius:6px;padding:10px 35px;margin:0 auto;">了解赚钱模式</span></div> 
                <div class="fs-16 tac" style="margin-top:25px;"><span style="border-bottom:1px solid #fff;">知道了</span></div>
            </div>
        </section>
    </section>
</div>
<script src="http://requirejs.org/docs/release/2.1.22/minified/require.js"></script>
<script>
require.config({
    paths: {
        "zepto": "http://w.qiandeer.com/qd/static/lock/assets/zepto",
        "api": "http://w.qiandeer.com/qd/static/lock/assets/api",
        "CountUp": "/static/lib/countup"
    },
    shim: {
        "zepto": {
            exports: "$"
        },
        "api": {
            deps: ['zepto'],
            exports: "API"
        },
        "CountUp": {
            exports: "CountUp"
        }
    }
});

require(['zepto', 'api', 'CountUp'], function ($, API, CountUp) {

    var params = API.getRequest(),
        clickStatus = true,  // “抢”按钮的状态
        outtimes = 0,   // 超时次数
        timeoutTips = $('#btn-getmoney');  // 超时提示

    // 获取积分
    function getBouns(){
        var request = $.ajax({
            url: "/hongbao/newer",
            type: 'POST',
            dataType: 'json',
            timeout: 10000,
            cache: false,
            success: function (data, textStatus, xhr) {
                if (data["code"] == 0) {
                    var bonus = data["data"]["bonus"],
                        showNumber=new CountUp('text-bonus', 0, bonus, 2, 2,options),
                        options = {
                            useEasing: true,
                            useGrouping: true,
                            separator: ',',
                            decimal: '.'
                        };

                    $('#section-welcome').hide();
                    $('#section-moneyget').show().addClass('zoom');
                    showNumber.start();
                }

                if(data["err"]){
                    if(data["err"]["code"] == 1){
                        if(params.vc >= 5){
                            location.href="/static/page/_guide.html";
                        }
                        else{
                            window.ups_sdk_events.doSomething(102,0,'');
                        }
                    }
                }
            },
            error: function(xhr,textStatus,errorThrown) {
                if(textStatus == 'timeout'){
                    outtimes += 1;
                    if(outtimes < 3){
                        request.abort();
                        timeoutTips.attr("data-content",'第'+' '+outtimes+' '+'次尝试重连');
                        getBouns();
                    } else {
                        timeoutTips.attr("data-content", "请重试");
                        outtimes = 0;
                        clickStatus = true;   
                    }
                }
            }});
    }    

    $('#section-welcome').click(function() {
        if(clickStatus){
            clickStatus = false;
            timeoutTips.attr("data-content", "连接中");
            getBouns();
        }
    });

    $('#section-moneyget').click(function() {
        if(params.vc >= 5){
            location.href="/static/page/_guide.html";
        }
        else{
            window.ups_sdk_events.doSomething(102,0,'');
        }
    });
});
</script>
</body>
</html>
